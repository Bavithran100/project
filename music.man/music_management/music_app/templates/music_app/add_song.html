{% extends 'music_app/base.html' %}

{% block title %}Add Song - Music Player{% endblock %}

{% block extra_css %}
<style>
    .add-song-header {
        margin-bottom: 2rem;
    }

    .add-song-header h1 {
        font-size: 2rem;
        font-weight: 700;
        color: var(--spotify-white);
        margin-bottom: 0.5rem;
    }

    .add-song-header p {
        color: var(--spotify-light-gray);
    }

    .add-song-form {
        background: var(--spotify-dark-gray);
        border-radius: 8px;
        padding: 2rem;
        max-width: 600px;
        margin: 0 auto;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: var(--spotify-light-gray);
        font-weight: 500;
    }

    .form-group input {
        width: 100%;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        color: var(--spotify-white);
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .form-group input:focus {
        outline: none;
        border-color: var(--spotify-green);
        background: rgba(255, 255, 255, 0.15);
    }

    .form-group input[type="file"] {
        padding: 0.5rem;
        background: none;
        border: 2px dashed rgba(255, 255, 255, 0.2);
        cursor: pointer;
    }

    .form-group input[type="file"]:hover {
        border-color: var(--spotify-green);
    }

    .form-group input[type="file"]::file-selector-button {
        background: var(--spotify-green);
        color: var(--spotify-black);
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        margin-right: 1rem;
    }

    .form-group input[type="file"]::file-selector-button:hover {
        background: #1ed760;
    }

    .form-group input[type="file"].audio-file {
        border: 2px dashed var(--spotify-green);
    }

    .form-group input[type="file"].audio-file::file-selector-button {
        background: var(--spotify-green);
        color: var(--spotify-black);
    }

    .form-group input[type="file"].audio-file::file-selector-button:hover {
        background: #1ed760;
    }

    .cover-preview {
        width: 200px;
        height: 200px;
        border-radius: 8px;
        overflow: hidden;
        margin-top: 1rem;
        display: none;
    }

    .cover-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .submit-button {
        background: var(--spotify-green);
        color: var(--spotify-black);
        border: none;
        padding: 1rem 2rem;
        border-radius: 24px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    .submit-button:hover {
        background: #1ed760;
        transform: scale(1.02);
    }

    .error-message {
        color: #ff4444;
        margin-top: 0.5rem;
        font-size: 0.875rem;
    }

    .errorlist {
        list-style: none;
        padding: 0;
        margin: 0.5rem 0;
        color: #ff4444;
        font-size: 0.875rem;
    }

    @media (max-width: 768px) {
        .add-song-form {
            padding: 1.5rem;
        }

        .cover-preview {
            width: 150px;
            height: 150px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="add-song-header">
    <h1>Add New Song</h1>
    <p>Share your favorite music with the world</p>
</div>

<form method="post" enctype="multipart/form-data" class="add-song-form">
    {% csrf_token %}
    
    {% for field in form %}
    <div class="form-group">
        {{ field.label_tag }}
        {{ field }}
        {% if field.errors %}
        <ul class="errorlist">
            {% for error in field.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
        {% endif %}
        {% if field.help_text %}
        <small class="help-text">{{ field.help_text }}</small>
        {% endif %}
    </div>
    {% endfor %}

    <button type="submit" class="submit-button">
        <i class="fas fa-plus"></i>
        Add Song
    </button>
</form>
{% endblock %}

{% block extra_js %}
<script>
    const coverInput = document.getElementById('id_cover_image');
    const audioInput = document.getElementById('id_audio_file');
    const coverPreview = document.querySelector('.cover-preview');
    const previewImg = document.getElementById('preview');

    if (coverInput) {
        coverInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    coverPreview.style.display = 'block';
                }
                reader.readAsDataURL(file);
            } else {
                coverPreview.style.display = 'none';
            }
        });
    }

    if (audioInput) {
        audioInput.classList.add('audio-file');
    }
</script>
{% endblock %}
